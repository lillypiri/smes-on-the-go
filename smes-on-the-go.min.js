function prepServiceWorker(){if(navigator.serviceWorker){navigator.serviceWorker.addEventListener("message",function(e){e.data.indexOf("Error:")>-1&&(snackbar.innerHTML=e.data.replace("Error: ",""))}),navigator.serviceWorker.register("sw.js").then(function(e){if(navigator.serviceWorker.controller)return e.waiting?void updateReady(e.waiting):e.installing?void trackInstalling(e.installing):void e.addEventListener("updatefound",function(){trackInstalling(e.installing)})});var e;navigator.serviceWorker.addEventListener("controllerchange",function(){e||(window.location.reload(),e=!0)})}}function trackInstalling(e){e.addEventListener("statechange",function(){"installed"==e.state&&updateReady(e)})}function updateReady(e){var t=document.getElementById("update-message"),o=document.getElementById("count-down-value"),a=[5,4,3,2,1];t.classList.remove("hidden"),window.setTimeout(function(){e.postMessage({action:"skipWaiting"})},5e3),a.forEach(function(e){window.setTimeout(function(){o.innerText=e},1e3*(5-e))})}function createMapClickHandler(e,t){var o=document.getElementById(e);o.addEventListener("click",function(){smesMap.changeMapStyle(e),document.getElementById("map-style-name").textContent=t})}function showDrawer(){var e=document.querySelector(".mdl-layout");e&&e.MaterialLayout.drawerToggleHandler_()}function showAbout(){overlayEl&&overlayEl.classList.remove("hidden")}function hideAbout(){overlayEl&&overlayEl.classList.add("hidden")}function clearSearch(){document.getElementById("location-search").value="",document.getElementById("clear-search-div").classList.add("hidden")}function setupMap(){var e={};mobileOS=isMobile(),e.pixelVerticalOffSet=-25,""!==mobileOS&&(e.mobile=mobileOS),0===mobileOS.indexOf("iOS")&&(2==window.devicePixelRatio?e.pixelVerticalOffSet=-28:3==window.devicePixelRatio&&(e.pixelVerticalOffSet=-54)),e.idle=requestMarkInformation,e.zoomChanged=displayZoomMessage,e.closeInfobox=function(){connectionIndicator.classList.remove("hidden")},smesMap=new SMESGMap("map",e),window.smesMap=smesMap,""!==mobileOS&&smesMap.map.setOptions({zoomControl:!1}),0===mobileOS.indexOf("iOS")&&(smesMap.pixelDensity=window.devicePixelRatio),smesMap.setUpAutoComplete("location-search","clear-search-div"),console.log("Map set-up: "+window.performance.now())}function geoLocate(){showLoader(),smesMap.geoLocate()}function finishedRetrieveAndLoad(){smesMap.refreshMarkers(),requestMarkInformation()}function requestMarkInformation(){if(!startingUp){var e,t,o;return e=smesMap.map.getCenter(),t=smesMap.mapSize||smesMap.checkSizeofMap(),showLoader(),console.log("requestMarkInformation, radius: "+t),o={},o.cLat=e.lat(),o.cLong=e.lng(),o.cRadius=t,o.finishedCallback=displayZoomMessage,o.tooManyCallback=displayZoomMessage,o.errorCallback=displayErrorMessage,o.cLat<vicExtents.minLat||o.cLat>vicExtents.maxLat||o.cLong<vicExtents.minLng||o.cLong<vicExtents.minLng?(console.log("Outside of Vic"),void hideLoader()):void markStore.requestMarkInformation(o)}}function showLoader(){loader.classList.remove("hidden"),connectIcon.textContent="cloud_queue",connectionIndicator.classList.remove("connection-off"),connectionIndicator.classList.remove("connected"),connectionIndicator.classList.add("pulsating"),connectToolTip.textContent="Connecting to Land Victoria",snackbar.innerHTML="Connecting to Land Victoria"}function hideLoader(){window.setTimeout(function(){loader.classList.add("hidden")},0)}function displayErrorMessage(){displayZoomMessage(!0)}function displayZoomMessage(e){hideLoader(),e=e||!1;var t,o=smesMap.getZoom();t=e?"An error occurred while retrieving marks<br/>Try zooming in":markStore.useLocalStore&&o>=14?"Can't load marks at this zoom<br>Displaying cached marks only<br>Zoom in to load marks":"Can't load marks at this zoom<br>Zoom in to load marks",!smesMap.mapSize||smesMap.mapSize>2||o<14||markStore.tooManyMarks||e?(connectIcon.textContent="cloud_off",connectionIndicator.classList.remove("pulsating"),connectionIndicator.classList.remove("connected"),connectionIndicator.classList.add("connection-off"),connectToolTip.innerHTML=t,snackbar.innerHTML=t):(connectIcon.textContent="cloud_done",connectionIndicator.classList.remove("connection-off"),connectionIndicator.classList.remove("pulsating"),connectionIndicator.classList.add("connected"),connectToolTip.innerHTML="Marks loaded",snackbar.innerHTML="Marks Loaded")}function loadMark(e,t,o){var a;a=prepMarkForMap(e),a&&a.marker&&("new"===t?smesMap.addMarker(a.marker,o):smesMap.updateMarker(a.marker))}function prepMarkForMap(e){var t,o,a={},r={};if(!(e.nineFigureNumber&&e.name&&e.latitude&&e.longitude))return console.log("Survey mark can't be prepped - data missing"),console.log(e),null;var i='<button id="close-info-box" class="close-button mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"><i class="material-icons">close</i></button>';o='<div class="mdl-card infobox mdl-shadow--3dp overflow-x-visible">';var n='<div class="card-content"><div class="card-left">',s='</div><div class="card-value">',l="</div></div>",c=returnMarkType(e);t=""!==mobileOS?'<button id="navigate'+e.nineFigureNumber+'" class="smes-button mdl-button mdl-js-button mdl-js-ripple-effect fade-in">Navigate</button>':"",a.domready=domReadyHandler(e.nineFigureNumber,e.name),a.click=markClickHandler(e.nineFigureNumber,parseFloat(e.latitude),parseFloat(e.longitude));var d=o+'<div class="mdl-card__title mdl-color-text--white"><div class="info-window-header"><div class="section__circle-container"><div class="section__circle-container__circle card-symbol"> <img class="info-symbol" src="symbology/'+c.iconName+'.png"></div></div><div class="header-text"><div class="nine-figure">'+e.nineFigureNumber+'</div><div><h3 class="mdl-card__title-text">'+e.name+'</h3></div><div class="mark-status">'+c.markDetails+"</div></div></div>"+i+'</div><div class="mdl-card__supporting-text"><div class="content-section"><div class="content-icon"><i class="material-icons">swap_horiz</i></div><div class="content">'+n+"Address:"+s+'<div id="address'+e.nineFigureNumber+'"></div>'+l+n+"GDA94:"+s+e.latitude+", "+e.longitude+l+n+"MGA:"+s+e.zone+", "+e.easting+", "+e.northing+l+n+"Technique:"+s+e.gda94Technique+l+n+"Ellipsoid height:"+s+e.ellipsoidHeight+l+n+"Uncertainty:"+s+e.hUncertainty+l+n+"Order:"+s+e.hOrder+l+n+"Measurements:"+s+e.gda94Measurements+l+'</div></div><div class="vert-spacer"></div><div class="content-section"><div class="content-icon"><i class="material-icons">swap_vert</i></div><div class="content">'+n+"AHD height:"+s+e.ahdHeight+l+n+"Technique:"+s+e.ahdTechnique+l+n+"Uncertainty:"+s+e.vUncertainty+l+n+"Order:"+s+e.vOrder+l+n+"Level section:"+s+e.ahdLevelSection+l+'</div></div></div><div id="info-box-loader" class="hidden mdl-progress mdl-js-progress mdl-progress__indeterminate"></div><div class="mdl-card__actions mdl-card--border"><div class="horiz-spacer"></div><button id="sketch'+e.nineFigureNumber+'" class="mdl-button mdl-js-button mdl-js-ripple-effect smes-button fade-in">Sketch</button><button id="report'+e.nineFigureNumber+'" class="mdl-button mdl-js-button mdl-js-ripple-effect smes-button fade-in">Report</button>'+t+"</div></div>";return r.lat=e.latitude,r.lng=e.longitude,r.title=e.name,r.icon="symbology/"+c.iconName,r.nineFigureNo=e.nineFigureNumber,r.eventListeners=a,r.infoWindowContent=d,{marker:r}}function markClickHandler(e,t,o){return function(){currentNineFigureNumber=e,currentLatLng.lat=t,currentLatLng.lng=o,connectionIndicator.classList.add("hidden"),console.log(e);var a=document.getElementById("close-info-box");a&&a.addEventListener("click",function(){var e=window.smesMap;e.infoBox.setVisible(!1),e.resetSelectedMarker()})}}function showBoxLoader(){var e=document.getElementById("info-box-loader");e&&e.classList.remove("hidden")}function hideBoxLoader(){var e=document.getElementById("info-box-loader");e&&e.classList.add("hidden")}function domReadyHandler(e,t){var o=t.replace(/  +/g," ");return function(){componentHandler.upgradeAllRegistered();var t=document.getElementById("address"+e),a="";t&&(a=markStore.returnAddress(currentNineFigureNumber),""!==a?t.innerHTML=a:smesMap.reverseGeocode(currentLatLng.lat,currentLatLng.lng).then(function(e){""!==e&&(t.innerHTML=e,markStore.setAddress(currentNineFigureNumber,e))})),document.querySelector("[id=sketch"+e+"]").addEventListener("click",function(){console.log("Sketch: "+e),showBoxLoader(),markStore.getSurveyMarkSketchResponse(e).then(function(t){var a=markStore.base64toBlob(t.document,"application/pdf");saveAs(a,o+"("+e+") Sketch.pdf"),hideBoxLoader()})["catch"](function(e){console.log("PDF retrieval failed"),snackbar.innerHTML="PDF retrieval failed",hideBoxLoader()})},!1),document.querySelector("[id=report"+e+"]").addEventListener("click",function(){console.log("Report: "+e),showBoxLoader(),markStore.getSurveyMarkReportResponse(e).then(function(t){var a=markStore.base64toBlob(t.document,"application/pdf");saveAs(a,o+"("+e+") Report.pdf"),hideBoxLoader()})["catch"](function(e){console.log("PDF retrieval failed"),snackbar.innerHTML="PDF retrieval failed",hideBoxLoader()})},!1),""!==mobileOS&&document.querySelector("[id=navigate"+e+"]").addEventListener("click",startNavigation,!1)}}function checkSearchNineFigure(){if(9===searchText.value.length&&searchText.value%1===0){var e=searchText.value;markStore.findNineFigureNumber(e).then(function(t){return smesMap.map.panTo(new google.maps.LatLng(t.lat,t.lng)),smesMap.map.zoom<17&&(smesMap.map.zoom=17),document.getElementById("location-search").blur(),searchText.classList.remove("not-found"),window.setTimeout(function(){for(var t=0;t<smesMap.markers.length;t++)if(smesMap.markers[t].nineFigureNo===parseInt(e))return void smesMap.markers[t].openInfoBox()},0),!0})["catch"](function(e){return console.log(e),!1})}}function returnMarkType(e){var t={},o=!1,a=!1,r=!1,i=!1,n=!1,s=r;return"OK"!=e.status?s=!0:("Yes"===e.scn&&(o=!0),""!==e.ahdHeight&&(r=!0),0===String(e.nineFigureNumber).indexOf("1")&&(a=!0),e.gda94Technique.indexOf(scnGDA94Value)>=0&&(i=!0),scnAHDValues.forEach(function(t){e.ahdTechnique.indexOf(t)>=0&&(n=!0)}),s?(t.iconName="defective",t.markDetails="Defective"):s||o||r?s||o||!r?!s&&o&&a?(t.iconName="scn-gda94-pcm",t.markDetails="SCN (GDA94)"):s||!o||r||a?!s&&o&&r&&!i?(t.iconName="scn-ahd-pm",t.markDetails="Non-SCN (GDA94), SCN (AHD)"):!s&&o&&r&&i&&n?(t.iconName="scn-gda94-ahd-pm",t.markDetails="SCN (GDA94), SCN (AHD)"):!s&&o&&r&&i&&!n&&(t.iconName="scn-gda94-ahdapprox-pm",t.markDetails="Non-SCN (GDA94)"):(t.iconName="scn-gda94-pm",t.markDetails="SCN (GDA94)"):(t.iconName="ahdapprox-pm",t.markDetails="Non-SCN (GDA94), non-SCN (AHD)"):(t.iconName="gda94approx-pm",t.markDetails="Non-SCN (GDA94)")),t}function isMobile(){var e=navigator.userAgent;return e.match(/Android/i)?"Android":/(iPad|iPhone|iPod)/gi.test(e)?/CriOS/.test(e)||/FxiOS/.test(e)||/OPiOS/.test(e)||/mercury/.test(e)?"iOS":"iOSSafari":""}function displayError(){errorMsg.classList.remove("hidden"),errorMsg.textContent="Too many requests have been sent to the server.  Please wait...",window.setTimeout(function(){clearError()},1e3)}function clearError(){errorMsg.classList.add("hidden")}function startNavigation(){if("number"==typeof currentLatLng.lat&&"number"==typeof currentLatLng.lng&&""!==mobileOS){var e;e="Android"===mobileOS?"google.navigation:q="+currentLatLng.lat+","+currentLatLng.lng:"http://maps.apple.com/?daddr="+currentLatLng.lat+","+currentLatLng.lng,window.open(e)}}var SMESMarkStore=function(e){"use strict";var t=this;e=e||{},t.maxRequests=12,t.perNumberOfSeconds=60,t.lastStorageTimeStamp=Date.now(),t.baseURL="https://maps.land.vic.gov.au/lvis/services/smesDataDelivery",t.tooManyMarks=!1,t.cacheDays=e.cacheDays||14,t.msecPerDay=864e5,t.markData={},e.loadMark&&(t.loadMark=e.loadMark),e.finishedRetrieve&&(t.finishedRetrieve=e.finishedRetrieve),window.addEventListener("beforeunload",function(e){t.executeSaveMarks()},!1)};SMESMarkStore.prototype.retrieveStoredMarks=function(){"use strict";var e=this,t=Date.now()-e.cacheDays*e.msecPerDay+1;if(window.localStorage){e.useLocalStore=!0;var o=window.localStorage.getItem("smes-mark-data");o&&(e.markData=JSON.parse(o));var a=Object.keys(e.markData);a.forEach(function(o){e.markData[o].lastUpdated>t&&!e.markData[o].dataHash?e.loadMark.apply(e,[e.markData[o],"new",!0]):delete e.markData[o]})}else e.useLocalStore=!1;e.finishedRetrieve&&e.finishedRetrieve.apply(e)},SMESMarkStore.prototype.clearStoredMarks=function(){"use strict";var e=this;if(e.useLocalStore)try{window.localStorage.removeItem("smes-mark-data")}catch(t){console.log(t)}},SMESMarkStore.prototype.saveMarksToStorage=function(){"use strict";var e=this;if(e.useLocalStore){var t;e.lastStorageTimeStamp=Date.now(),t=e.lastStorageTimeStamp,window.setTimeout(function(){t===e.lastStorageTimeStamp&&e.executeSaveMarks()},6e4)}},SMESMarkStore.prototype.executeSaveMarks=function(){"use strict";var e,t=this;try{window.localStorage.setItem("smes-mark-data",JSON.stringify(t.markData)),console.log("Data written to local storage")}catch(o){try{JSON.stringify(t.markData).length>5e6&&(e=t.removeOldMarks(7)),JSON.stringify(e).length>5e6&&(e=t.removeOldMarks(14)),window.localStorage.setItem("smes-mark-data",JSON.stringify(e))}catch(o){console.log("Write to local storage failed")}}},SMESMarkStore.prototype.removeOldMarks=function(e){"use strict";var t=this,o=Date.now()-e*t.msecPerDay+1,a=t.markData;return a.forEach(function(e){e.lastUpdated<o&&delete a[e.nineFigureNumber]}),a},SMESMarkStore.prototype.delayNextRequest=function(){"use strict";var e=this;e.lastSuccesfullRetrieve=Date.now()+2e4},SMESMarkStore.prototype.requestMarkInformation=function(e){"use strict";var t=this,o=new Date,a=500;if(e.cRadius>2)return console.log("Unacceptable radius value: "+e.cRadius),void e.errorCallback.apply(t);t.lastQueuedTimeStamp=o;var r=t.perNumberOfSeconds/t.maxRequests*1e3;if(t.lastSuccesfullRetrieve){var i=o-t.lastSuccesfullRetrieve;i<r&&(a=r-i+a)}window.setTimeout(function(){o===t.lastQueuedTimeStamp?(console.log("Processing request"),t.lastSuccesfullRetrieve=new Date,t.retrieveMarkInformation(e.cLat,e.cLong,e.cRadius).then(function(o){o&&t.processRetrievedMarks(o).then(function(){console.log("Executing callback"),t.tooManyMarks=!1,e.finishedCallback.apply(t)})})["catch"](function(o){"Too many marks"===o?(t.tooManyMarks=!0,e.tooManyCallback.apply(t)):e.errorCallback.apply(t),console.log(o)})):console.log("Dropping request - newer request has arrived")},a)},SMESMarkStore.prototype.processRetrievedMarks=function(e){"use strict";var t=this;return Array.isArray(e)||(e=[e]),new Promise(function(o,a){if(t.useLocalStore){new Date;e.forEach(function(e){var o,a="new";if(t.markData[e.nineFigureNumber]){var r=Object.keys(e);a="update",o=!0;for(var i=0;i<r.length;i++)if(e[r[i]]!==t.markData[e.nineFigureNumber][r[i]]){o=!1;break}}o?t.markData[e.nineFigureNumber].lastUpdated=Date.now():(e.lastUpdated=Date.now(),t.markData[e.nineFigureNumber]=e,t.loadMark.apply(t,[e,a]))}),t.saveMarksToStorage(),o(!0)}else e.forEach(function(e){t.loadMark.apply(t,[e,"new"])}),o(!0)})},SMESMarkStore.prototype.findNineFigureNumber=function(e){"use strict";var t=this,o={};return new Promise(function(a,r){9===e.length&&e%1===0?t.markData[e]?(o.lat=t.markData[e].latitude,o.lng=t.markData[e].longitude,a(o)):(console.log("Processing nineFigureNumber request"),t.lastSuccesfullRetrieve=new Date,t.retrieveMarkByNineFigure(e).then(function(i){i?t.processRetrievedMarks(i).then(function(){console.log("Executing callback"),t.tooManyMarks=!1,o.lat=t.markData[e].latitude,o.lng=t.markData[e].longitude,a(o)}):r("Not found")})["catch"](function(e){r("Not found")})):r("Not a Nine Figure NUmber")})},SMESMarkStore.prototype.setAddress=function(e,t){"use strict";var o=this;o.useLocalStore&&o.markData[e]&&(o.markData[e].address=t)},SMESMarkStore.prototype.returnAddress=function(e){"use strict";var t=this,o="";return t.useLocalStore&&t.markData[e]&&(o=t.markData[e].address||""),o},SMESMarkStore.prototype.retrieveMarkInformation=function(e,t,o){"use strict";var a=this;return new Promise(function(r,i){fetch(a.baseURL+"/getMarkInformation?searchType=Location&latitude="+e+"&longitude="+t+"&radius="+o+"&format=Full",{mode:"cors"}).then(function(e){return e.json()}).then(function(e){"undefined"==typeof e.messages?r(e.data):"More than 250 marks were found for this search. Please refine your search criteria."===e.messages.message?(console.log("Too many marks"),i("Too many marks")):"No survey marks matched the criteria provided."===e.messages.message?(console.log("No marks found"),r([])):(console.log(e.messages.message),i("Webservice error"))})["catch"](function(e){console.log(e),a.delayNextRequest(),console.log("Too many requests"),i(e)})})},SMESMarkStore.prototype.retrieveMarkByNineFigure=function(e){"use strict";var t=this;return new Promise(function(o,a){fetch(t.baseURL+"/getMarkInformation?searchType=NineFigureNumber&nineFigureNumber="+e+"&format=Full",{mode:"cors"}).then(function(e){return e.json()}).then(function(e){"undefined"==typeof e.messages?o(e.data):"More than 250 marks were found for this search. Please refine your search criteria."===e.messages.message?(console.log("Too many marks"),a("Too many marks")):"No survey marks matched the criteria provided."===e.messages.message?(console.log("No marks found"),o([])):(console.log(e.messages.message),a("Webservice error"))})["catch"](function(e){console.log(e),t.delayNextRequest(),console.log("Too many requests"),a(e)})})},SMESMarkStore.prototype.getSurveyMarkSketchResponse=function(e){"use strict";var t=this;return new Promise(function(o,a){fetch(t.baseURL+"/getSurveyMarkSketches?returnDefective=true&markList="+e,{mode:"cors"}).then(function(e){return e.json()}).then(function(e){"undefined"==typeof e.messages?o(e.data):(console.log(e.messages.message),a("Webservice error"))})["catch"](function(e){return console.log(e),Promise.reject(e)})})},SMESMarkStore.prototype.getSurveyMarkReportResponse=function(e){"use strict";var t=this;return new Promise(function(o,a){fetch(t.baseURL+"/getSurveyMarkReports?returnDefective=true&markList="+e,{mode:"cors"}).then(function(e){return e.json()}).then(function(e){"undefined"==typeof e.messages?o(e.data):(console.log(e.messages.message),a("Webservice error"))})["catch"](function(e){return console.log(),Promise.reject(e)})})},SMESMarkStore.prototype.base64toBlob=function(e,t,o){"use strict";t=t||"",o=o||512;for(var a=atob(e),r=[],i=0;i<a.length;i+=o){for(var n=a.slice(i,i+o),s=new Array(n.length),l=0;l<n.length;l++)s[l]=n.charCodeAt(l);var c=new Uint8Array(s);r.push(c)}var d=new Blob(r,{type:t});return d};var SMESGMap=function(e,t){"use strict";var o,a=this,r=this.getMapState()||{};o=r.lat&&r.lng?new google.maps.LatLng(r.lat,r.lng):new google.maps.LatLng((-37.813942),144.9711861),a.setupMapStyles(),a.mapStyleName=r.mapStyleName||"iovation",t=t||{},t.mapOptions=t.mapOptions||{center:o,zoom:r.zoom||15,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},scaleControl:!0,streetViewControl:!1,streetViewControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},panControl:!1,rotateControl:!1,styles:this.mapStyles[this.mapStyleName]},a.mapOptions=t.mapOptions,a.markers=[],a.labels=[],a.markerIcons=[],a.pixelDensity=1,a.pixelVerticalOffSet=t.pixelVerticalOffSet||0,a.mobile=t.mobile||!1,a.map=new google.maps.Map(document.getElementById(e),a.mapOptions),a.geocoder=new google.maps.Geocoder,a.infoWindow=new google.maps.InfoWindow,a.infoBox=new InfoBox({content:document.getElementById("infobox"),disableAutoPan:!1,maxWidth:440,pixelOffset:new google.maps.Size((-220),a.pixelVerticalOffSet),zIndex:25,closeBoxURL:"",infoBoxClearance:new google.maps.Size(4,4)}),a.setZoomLevel(),google.maps.event.addListener(a.map,"zoom_changed",function(){a.setZoomLevel()}),"function"==typeof t.zoomChanged&&google.maps.event.addListener(a.map,"zoom_changed",function(e){void 0===e&&(e=a),t.zoomChanged.apply(a,[e])}),google.maps.event.addListener(a.map,"idle",function(){a.checkSizeofMap(),a.refreshMarkers(),a.saveMapState()}),"function"==typeof t.idle&&google.maps.event.addListener(a.map,"idle",function(e){void 0===e&&(e=a),t.idle.apply(a,[e])});var i=a.infoBox;google.maps.event.addListener(i,"domready",function(){var e=document.getElementById("close-info-box");e&&e.addEventListener("click",function(){i.setVisible(!1),a.resetSelectedMarker(),"function"==typeof t.closeInfobox&&t.closeInfobox.apply(a)})}),a.resizeInfoBox(),window.onresize=a.resizeInfoBox(),console.log(a.pixelVerticalOffSet)};SMESGMap.prototype.resizeInfoBox=function(){"use strict";var e=this,t=window.innerWidth,o=e.infoBox.maxWidth_;(t<440||o<440)&&t!==o&&(t>440&&(t=440),e.infoBox.setOptions({maxWidth:t,pixelOffset:new google.maps.Size(t*-.5,e.pixelVerticalOffSet)}))},SMESGMap.prototype.getMapState=function(){"use strict";var e={};return window.localStorage?e=JSON.parse(window.localStorage.getItem("map-state"))||{}:e},SMESGMap.prototype.saveMapState=function(){"use strict";var e=this,t={},o=e.getMapPosition();if(t.zoom=e.getZoom(),t.zoom>18&&(t.zoom=18),t.mapStyleName=e.mapStyleName,t.lat=o.lat,t.lng=o.lng,window.localStorage)try{window.localStorage.setItem("map-state",JSON.stringify(t))}catch(a){console.log("Write to local storage failed")}},SMESGMap.prototype.geoLocate=function(){"use strict";var e=this;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){var o=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);e.map.setCenter(o)},function(e){console.log(e)})},SMESGMap.prototype.getMapPosition=function(){"use strict";var e=this,t=e.map.getCenter(),o={};return o.lat=t.lat(),o.lng=t.lng(),o},SMESGMap.prototype.getZoom=function(){"use strict";var e=this;return e.map.getZoom()},SMESGMap.prototype.addMarker=function(e,t){"use strict";var o,a,r,i,n,s,l,c,d=this;o=e.lat,a=e.lng,r=e.title,i=e.icon,n=e.nineFigureNo,s=e.infoWindowContent,l=e.eventListeners||null,d.markersVisible&&!t&&(c=d.map);var m={url:i+".png",size:new google.maps.Size(d.markerSize*d.pixelDensity,d.markerSize*d.pixelDensity),scaledSize:new google.maps.Size(d.markerSize,d.markerSize)},p=new google.maps.Marker({position:new google.maps.LatLng(o,a),title:r,map:c,draggable:!1,icon:m,animation:google.maps.Animation.DROP,infoContent:s,nineFigureNo:n});if(p.openInfoBox=function(){var e=document.getElementById("infobox");if(e.innerHTML=p.infoContent,d.setSelectedMarker(p),d.infoBox.open(d.map,this),d.infoBox.setVisible(!0),d.map.panTo(p.position),""!==d.mobile){var t=10;"iOSSafari"===d.mobile&&(t=100/window.devicePixelRatio),window.setTimeout(function(){d.map.panBy(0,t)},10)}l&&l.click&&l.click.apply(),l&&l.domready&&window.setTimeout(function(){l.domready.apply(this)},0)},p.addListener("click",p.openInfoBox),d.markers.push(p),d.labelsVisible){var u={};u.position=p.position,u.label=p.title,u.nineFigureNo=p.nineFigureNo,d.addLabel(u)}},SMESGMap.prototype.updateMarker=function(e){"use strict";var t,o,a,r,i,n,s,l,c=this;t=e.lat,o=e.lng,a=e.title,r=e.icon,i=e.nineFigureNo,n=e.infoWindowContent;for(var d=0;d<c.markers.length;d++)if(c.markers[d].nineFigureNo===i){s=c.markers[d];break}s&&(l={url:r+".png",size:new google.maps.Size(c.markerSize*c.pixelDensity,c.markerSize*c.pixelDensity),scaledSize:new google.maps.Size(c.markerSize,c.markerSize)},s.setIcon(l),s.setPosition(new google.maps.LatLng(t,o)),s.setTitle(a),s.infoContent=n);for(var m=0;m<c.markers.length;m++)if(c.markers[m].nineFigureNo===i){c.markers.splice(m,1);break}},SMESGMap.prototype.setSelectedMarker=function(e){"use strict";var t,o=this,a=e.icon,r=a.url;o.resetSelectedMarker(),r=r.replace("selected-","");var i=r.lastIndexOf("/");r=r.substr(0,i+1)+"selected-"+r.substr(i+1),t=2*o.markerSize,a.scaledSize=new google.maps.Size(t,t),a.size=new google.maps.Size(t*o.pixelDensity,t*o.pixelDensity),a.url=r,e.zIndex=100,e.setIcon(a),e.isSelected=!0},SMESGMap.prototype.resetSelectedMarker=function(){"use strict";for(var e,t,o=this,a=0;a<o.markers.length;a++)o.markers[a].isSelected&&(e=o.markers[a].icon,t=e.url,t=t.replace("selected-",""),e.scaledSize=new google.maps.Size(o.markerSize,o.markerSize),e.size=new google.maps.Size(o.markerSize*o.pixelDensity,o.markerSize*o.pixelDensity),e.url=t,o.markers[a].setIcon(e),delete o.markers[a].isSelected)},SMESGMap.prototype.addLabel=function(e){"use strict";var t=this,o=new MapLabel({text:e.label,position:e.position,map:t.map,fontFamily:"Sans-Serif",strokeWeight:2,fontColor:"#193e69",strokeColor:"#FFF",fontSize:13,align:"center",nineFigureNo:e.nineFigureNo});t.labels.push(o)},SMESGMap.prototype.setZoomLevel=function(){"use strict";var e=this,t=e.map.getZoom();t<14?e.markersVisible=!1:t>=14&&(e.markersVisible=!0),t>=19?e.labelsVisible=!0:e.labelsVisible=!1,e.zoomLevel=e.map.getZoom(),e.markerSize=9+1.75*(e.zoomLevel-14)},SMESGMap.prototype.clearLabels=function(){"use strict";for(var e=this,t=0;t<e.labels.length;t++)e.labels[t].setMap(null);e.labels.length=0},SMESGMap.prototype.refreshMarkers=function(){"use strict";var e,t,o,a=this,r=a.map.getBounds();a.clearLabels();for(var i=0;i<a.markers.length;i++)if(o=a.markers[i].position,a.markersVisible&&r.contains(o)){if(e=a.markers[i].icon,t=a.markerSize||14,a.markers[i].isSelected&&(t=2*t),t!=e.size.width&&(e.scaledSize=new google.maps.Size(t,t),e.size=new google.maps.Size(t*a.pixelDensity,t*a.pixelDensity),a.markers[i].setIcon(e)),a.markers[i].map||a.markers[i].setMap(a.map),a.labelsVisible){var n={};n.position=o,n.label=a.markers[i].title,n.nineFigureNo=a.markers[i].nineFigureNo,a.addLabel(n)}}else a.markers[i].setMap(null)},SMESGMap.prototype.reverseGeocode=function(e,t){"use strict";var o=this;return new Promise(function(a,r){var i={lat:e,lng:t};o.geocoder.geocode({location:i},function(e,t){if(t===google.maps.GeocoderStatus.OK)if(e[0]){var o=e[0].formatted_address.replace(", Australia",""),i=o.indexOf("VIC ");i>0&&(o=o.substr(0,i-1)),a(o)}else a("");else console.log("Geocoder failed due to: "+t),r("Geocoder failed due to: "+t)})})},SMESGMap.prototype.setUpAutoComplete=function(e,t){"use strict";var o=this,a=document.getElementById(e),r=new google.maps.InfoWindow,i=document.getElementById(t),n=new google.maps.Marker({map:o.map,anchorPoint:new google.maps.Point(0,(-29))});o.autoComplete=new google.maps.places.Autocomplete(a),o.autoComplete.bindTo("bounds",o.map),a.addEventListener("input",function(){a.classList.remove("not-found"),""===a.value?i.classList.add("hidden"):i.classList.remove("hidden")}),o.autoComplete.addListener("place_changed",function(){r.close(),n.setVisible(!1);var e=o.autoComplete.getPlace();if(!e.geometry)return void a.classList.add("not-found");a.classList.remove("not-found"),e.geometry.viewport?o.map.fitBounds(e.geometry.viewport):(o.map.setZoom(17),o.map.setCenter(e.geometry.location)),n.setPosition(e.geometry.location),n.setVisible(!0);var t="";e.address_components&&(t=[e.address_components[0]&&e.address_components[0].short_name||"",e.address_components[1]&&e.address_components[1].short_name||"",e.address_components[2]&&e.address_components[2].short_name||""].join(" ")),r.setContent("<div><strong>"+e.name+"</strong><br>"+t+"</div>"),r.open(o.map,n)}),n.addListener("click",function(){r.open(o.map,n)})},SMESGMap.prototype.checkSizeofMap=function(){"use strict";var e=this,t=e.map.getCenter(),o=e.map.getBounds().getSouthWest();if("undefined"!=typeof o&&"undefined"!=typeof t){var a=e.getDistanceKms(t.lat(),t.lng(),o.lat(),o.lng());e.mapSize=a/1e3}else e.mapSize=0;return e.mapSize},SMESGMap.prototype.getDistanceKms=function(e,t,o,a){"use strict";var r=this,i=6378137,n=r.calcRad(o-e),s=r.calcRad(a-t),l=Math.sin(n/2)*Math.sin(n/2)+Math.cos(r.calcRad(e))*Math.cos(r.calcRad(o))*Math.sin(s/2)*Math.sin(s/2),c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),d=i*c;return d},SMESGMap.prototype.calcRad=function(e){"use strict";return e*Math.PI/180},SMESGMap.prototype.changeMapStyle=function(e){"use strict";var t,o=this;o.mapStyleName=e,"google"!==e&&o.mapStyles[e]&&(t=o.mapStyles[e]),o.map.setOptions({styles:t})},SMESGMap.prototype.setupMapStyles=function(){"use strict";var e=this;e.mapStyles={coolgrey:[{featureType:"landscape",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{stylers:[{hue:"#00aaff"},{saturation:-100},{gamma:2.15},{lightness:12}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{visibility:"on"},{lightness:24}]},{featureType:"road",elementType:"geometry",stylers:[{lightness:57}]}],darkgrey:[{featureType:"landscape",stylers:[{saturation:-100},{lightness:65},{visibility:"on"}]},{featureType:"poi",stylers:[{saturation:-100},{lightness:51},{visibility:"simplified"}]},{featureType:"road.highway",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"road.arterial",stylers:[{saturation:-100},{lightness:30},{visibility:"on"}]},{featureType:"road.local",stylers:[{saturation:-100},{lightness:40},{visibility:"on"}]},{featureType:"transit",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"administrative.province",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"on"},{lightness:-25},{saturation:-100}]},{featureType:"water",elementType:"geometry",stylers:[{hue:"#ffff00"},{lightness:-25},{saturation:-97}]}],paledawn:[{featureType:"administrative",elementType:"all",stylers:[{visibility:"on"},{lightness:33}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2e5d4"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#c5dac6"}]},{featureType:"poi.park",elementType:"labels",stylers:[{visibility:"on"},{lightness:20}]},{featureType:"road",elementType:"all",stylers:[{lightness:20}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#c5c6c6"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#e4d7c6"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#fbfaf7"}]},{featureType:"water",elementType:"all",stylers:[{visibility:"on"},{color:"#acbcc9"}]}],shiftworker:[{stylers:[{saturation:-100},{gamma:1}]},{elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.business",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"poi.place_of_worship",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"simplified"}]},{featureType:"water",stylers:[{visibility:"on"},{saturation:50},{gamma:0},{hue:"#50a5d1"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{color:"#333333"}]},{featureType:"road.local",elementType:"labels.text",stylers:[{weight:.5},{color:"#333333"}]},{featureType:"transit.station",elementType:"labels.icon",stylers:[{gamma:1},{saturation:50}]}],simplelight:[{featureType:"administrative",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"landscape",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#fcfcfc"}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#fcfcfc"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#dddddd"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#dddddd"}]},{featureType:"road.local",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#eeeeee"}]},{featureType:"water",elementType:"geometry",stylers:[{visibility:"simplified"},{color:"#dddddd"}]}],muted:[{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"
}]},{featureType:"administrative.locality",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"},{visibility:"simplified"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"simplified"},{saturation:"-65"},{lightness:"45"},{gamma:"1.78"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{saturation:"-33"},{lightness:"22"},{gamma:"2.08"}]},{featureType:"transit.station.airport",elementType:"geometry",stylers:[{gamma:"2.08"},{hue:"#ffa200"}]},{featureType:"transit.station.airport",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit.station.rail",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"transit.station.rail",elementType:"labels.icon",stylers:[{visibility:"simplified"},{saturation:"-55"},{lightness:"-2"},{gamma:"1.88"},{hue:"#ffab00"}]},{featureType:"water",elementType:"all",stylers:[{color:"#bbd9e5"},{visibility:"simplified"}]}],iovation:[{featureType:"all",elementType:"geometry",stylers:[{gamma:"0.82"}]},{featureType:"all",elementType:"geometry.fill",stylers:[{gamma:"1.21"}]},{featureType:"all",elementType:"labels",stylers:[{lightness:"-60"}]},{featureType:"all",elementType:"labels.text",stylers:[{gamma:"5.37"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{color:"#419d8c"},{lightness:"-39"}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#ffffff"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#fefefe"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#fefefe"},{lightness:17},{weight:1.2}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#f5f5f5"},{lightness:20}]},{featureType:"landscape.natural",elementType:"geometry.fill",stylers:[{saturation:"0"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#f5f5f5"},{lightness:21}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#dedede"},{lightness:21}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffffff"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#ffffff"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:18}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:16}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#f2f2f2"},{lightness:19}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#e9e9e9"},{lightness:17}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#42738d"},{gamma:"5.37"}]}],ultralight:[{featureType:"water",elementType:"geometry",stylers:[{color:"#e9e9e9"},{lightness:17}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#f5f5f5"},{lightness:20}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffffff"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#ffffff"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:18}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:16}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#f5f5f5"},{lightness:21}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#dedede"},{lightness:21}]},{elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#ffffff"},{lightness:16}]},{elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#333333"},{lightness:40}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#f2f2f2"},{lightness:19}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#fefefe"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#fefefe"},{lightness:17},{weight:1.2}]}]}};var startingUp,loader,connectionIndicator,connectIcon,connectToolTip,locateButton,zoomInMsg,errorMsg,mobileOS,elTimer,overlayEl,searchText,smesMap,markStore,scnAHDValues=["ZEROTH ORDER","2ND ORDER","3RD ORDER","SPIRIT LEVELLING"],scnGDA94Value="ADJUSTMENT",pcmSearchText="PCM",currentNineFigureNumber,currentLatLng={},currentRadius,vicExtents={};vicExtents.minLat=-39.56912880425731,vicExtents.maxLat=-33.43769367843318,vicExtents.minLng=140.64925642150877,vicExtents.maxLng=152.03658552307127,prepServiceWorker(),window.addEventListener("load",function(e){startingUp=!0,loader=document.getElementById("loader"),connectionIndicator=document.getElementById("connection-indicator"),connectIcon=document.getElementById("connect-icon"),connectToolTip=document.getElementById("connection-tooltip"),snackbar=document.querySelector(".snackbar"),zoomInMsg=document.getElementById("zoom-in-msg"),locateButton=document.getElementById("locate"),locateButton.addEventListener("click",geoLocate,!1),document.getElementById("hamburger-menu").addEventListener("click",showDrawer,!1),document.getElementById("clear-search").addEventListener("click",clearSearch,!1),document.getElementById("nav-about").addEventListener("click",showAbout,!1),document.getElementById("about-OK").addEventListener("click",hideAbout,!1),searchText=document.getElementById("location-search"),searchText.addEventListener("input",checkSearchNineFigure,!1),overlayEl=document.getElementById("screen-overlay"),setupMap();var t={};t.loadMark=loadMark,t.finishedRetrieve=finishedRetrieveAndLoad,markStore=new SMESMarkStore(t),window.setTimeout(function(){startingUp=!1,markStore.retrieveStoredMarks()},1e3),window.setTimeout(function(){for(var e=document.getElementById("style-option-list"),t=0;t<e.childNodes.length;t++)1===e.childNodes[t].nodeType&&createMapClickHandler(e.childNodes[t].id,e.childNodes[t].textContent),smesMap.mapStyleName&&smesMap.mapStyleName===e.childNodes[t].id&&(document.getElementById("map-style-name").textContent=e.childNodes[t].textContent)},0)},!1);